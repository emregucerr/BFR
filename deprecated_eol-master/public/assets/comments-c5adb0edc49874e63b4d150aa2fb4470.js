if(!EOL)var EOL={};EOL.handle_special_anchors_in_location_hash=function(){if(""!==location.hash){var e=location.hash.replace(/#/,"").replace(/\?.*$/,""),t=e.replace("reply-to-","");e==t?EOL.highlight_comment($("#"+e),!0):$("#"+t).find("li.reply a").click()}},EOL.highlight_comment=function(e,t){if(0===$(e).size())return!1;var i=$(e).offset().top;return $("li").removeClass("highlight"),e.closest("li").toggleClass("highlight"),t||$("html,body").animate({scrollTop:i},650),!1},EOL.reply_to=function(e){var t=e.attr("href"),i=EOL.jump_to_comment($("#"+t.replace(/^.*#reply-to-/,"")),t,!0);if(!i){var n=$("form#new_comment");0===n.size()?EOL.redirect_to_comment_source(t):($("html,body").animate({scrollTop:n.offset().top},650),EOL.add_reply_details(n,e),$("a#reply-cancel").on("click",function(e){e.preventDefault(),EOL.reset_reply_details(n)}),n.find("textarea").focus())}},EOL.reset_reply_details=function(e){var t=e.find(":submit");t.val(t.data("post")),t.parent().find("span").remove(),EOL.set_reply_fields(e,""),$("li").removeClass("highlight")},EOL.add_reply_details=function(e,t){var i=e.find(":submit");i.parent().find("span").remove(),i.data("post",i.val()).val(i.data("reply")),i.after('<span id="reply-to">@'+t.data("reply-to")+' &nbsp; <a id="reply-cancel" href="#">'+i.data("cancel")+"</a></span>"),EOL.set_reply_fields(e,t)},EOL.set_reply_fields=function(e,t){e.find("input#comment_reply_to_type").val(t?t.data("reply-to-type"):""),e.find("input#comment_reply_to_id").val(t?t.data("reply-to-id"):"")},EOL.follow_reply=function(e){var t=$(e).attr("href");EOL.jump_to_comment($(t),t,!1)},EOL.redirect_to_comment_source=function(e,t){window.location="/activity_logs/find/"+e.replace(/^.*-(\d+)$/,"$1")+"?"+$.param({type:e.replace(/^.*[#-]([^-]+)-\d+$/,"$1"),reply:t})},EOL.close_enough=function(e){var t=e.replace(/#.*$/,"").replace(/^.*\/\/[^\/]*\//,"").replace(/^\//,""),i=t.split("/"),n=location.pathname.replace(/^\/+/,"").split("/");return i[0]==n[0]&&i[1]==i[1]?!0:i[1]==n[1]&&i[2]==i[2]?!0:!1},EOL.jump_to_comment=function(e,t,i){return 0===e.size()||i&&!EOL.close_enough(t)?(EOL.redirect_to_comment_source(t,i),!0):(EOL.highlight_comment(e,i),!1)},EOL.init_comment_behaviours=function(){var e=$("ul.feed"),t=e.find("blockquote a[href^=#]");t.unbind("click"),t.on("click",function(e){e.preventDefault(),EOL.follow_reply($(this))});var i=e.find("ul.actions li.reply a");i.unbind("click"),i.on("click",function(e){e.preventDefault(),EOL.reply_to($(this))});var n=e.find("ul.actions a.edit_comment");n.unbind("click"),n.on("click",function(e){e.preventDefault(),$(this).closest("ul.actions").hide();var t=$(this).closest(".editable").find("blockquote").hide().end().find(".details");t.after('<div class="comment_edit_form"></div>');var i=t.next(".comment_edit_form");return EOL.ajax_get($(this),{update:i,type:"GET"}),!1});var s=e.find(".comment_edit_form a");s.unbind("click"),s.on("click",function(e){e.preventDefault(),$(this).closest(".comment_edit_form").hide().closest("li").find("ul.actions").show().end().find("blockquote").show().end().end().remove()});var o=e.find(".comment_edit_form input[type='submit']");o.unbind("click"),o.on("click",function(e){return e.preventDefault(),EOL.ajax_submit($(this)),!1});var a=e.find("form.delete_comment input[type='submit']");a.unbind("click"),a.on("click",function(e){return e.preventDefault(),confirm($(this).data("confirmation"))&&EOL.ajax_submit($(this)),!1})},$(function(){EOL.init_comment_behaviours(),EOL.handle_special_anchors_in_location_hash(),$("ul.feed").ajaxSuccess(function(){EOL.init_comment_behaviours()})});