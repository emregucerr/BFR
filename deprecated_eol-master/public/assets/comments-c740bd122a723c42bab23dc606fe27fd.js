if(!EOL)var EOL={};EOL.handle_special_anchors_in_location_hash=function(){if(""!==location.hash){var t=location.hash.replace(/#/,"").replace(/\?.*$/,""),e=t.replace("reply-to-","");t==e?EOL.highlight_comment($("#"+t),!0):$("#"+e).find("li.reply a").click()}},EOL.highlight_comment=function(t,e){if(0===$(t).size())return!1;var i=$(t).offset().top;return $("li").removeClass("highlight"),t.closest("li").toggleClass("highlight"),e||$("html,body").animate({scrollTop:i},650),!1},EOL.reply_to=function(t){var e=t.attr("href"),i=EOL.jump_to_comment($("#"+e.replace(/^.*#reply-to-/,"")),e,!0);if(!i){var n=$("form#new_comment");0===n.size()?EOL.redirect_to_comment_source(e):($("html,body").animate({scrollTop:n.offset().top},650),EOL.add_reply_details(n,t),$("a#reply-cancel").on("click",function(t){t.preventDefault(),EOL.reset_reply_details(n)}),n.find("textarea").focus())}},EOL.reset_reply_details=function(t){var e=t.find(":submit");e.val(e.data("post")),e.parent().find("span").remove(),EOL.set_reply_fields(t,""),$("li").removeClass("highlight")},EOL.add_reply_details=function(t,e){var i=t.find(":submit");i.parent().find("span").remove(),i.data("post",i.val()).val(i.data("reply")),i.after('<span id="reply-to">@'+e.data("reply-to")+' &nbsp; <a id="reply-cancel" href="#">'+i.data("cancel")+"</a></span>"),EOL.set_reply_fields(t,e)},EOL.set_reply_fields=function(t,e){t.find("input#comment_reply_to_type").val(e?e.data("reply-to-type"):""),t.find("input#comment_reply_to_id").val(e?e.data("reply-to-id"):"")},EOL.follow_reply=function(t){var e=$(t).attr("href");EOL.jump_to_comment($(e),e,!1)},EOL.redirect_to_comment_source=function(t,e){window.location="/activity_logs/find/"+t.replace(/^.*-(\d+)$/,"$1")+"?"+$.param({type:t.replace(/^.*[#-]([^-]+)-\d+$/,"$1"),reply:e})},EOL.close_enough=function(t){var e=t.replace(/#.*$/,"").replace(/^.*\/\/[^\/]*\//,"").replace(/^\//,""),i=e.split("/"),n=location.pathname.replace(/^\/+/,"").split("/");return i[0]==n[0]&&i[1]==i[1]?!0:i[1]==n[1]&&i[2]==i[2]?!0:!1},EOL.jump_to_comment=function(t,e,i){return 0===t.size()||i&&!EOL.close_enough(e)?(EOL.redirect_to_comment_source(e,i),!0):(EOL.highlight_comment(t,i),!1)},EOL.init_comment_behaviours=function(){var t=$("ul.feed"),e=t.find("blockquote a[href^=#]");e.unbind("click"),e.on("click",function(t){t.preventDefault(),EOL.follow_reply($(this))});var i=t.find("ul.actions li.reply a");i.unbind("click"),i.on("click",function(t){t.preventDefault(),EOL.reply_to($(this))});var n=t.find("ul.actions a.edit_comment");n.unbind("click"),n.on("click",function(t){t.preventDefault(),$(this).closest("ul.actions").hide();var e=$(this).closest(".editable").find("blockquote").hide().end().find(".details");e.after('<div class="comment_edit_form"></div>');var i=e.next(".comment_edit_form");return EOL.ajax_get($(this),{update:i,type:"GET"}),!1});var s=t.find(".comment_edit_form a");s.unbind("click"),s.on("click",function(t){t.preventDefault(),$(this).closest(".comment_edit_form").hide().closest("li").find("ul.actions").show().end().find("blockquote").show().end().end().remove()});var o=t.find(".comment_edit_form input[type='submit']");o.unbind("click"),o.on("click",function(t){return t.preventDefault(),EOL.ajax_submit($(this)),!1});var r=t.find("form.delete_comment input[type='submit']");r.unbind("click"),r.on("click",function(t){return t.preventDefault(),confirm($(this).data("confirmation"))&&EOL.ajax_submit($(this)),!1})},$(function(){EOL.init_comment_behaviours(),EOL.handle_special_anchors_in_location_hash(),$("ul.feed").ajaxSuccess(function(){EOL.init_comment_behaviours()})});