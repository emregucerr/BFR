function DragZoomControl(e,t,o){this.globals={draggingOn:!1,cornerTopDiv:null,cornerRightDiv:null,cornerBottomDiv:null,cornerLeftDiv:null,mapPosition:null,outlineDiv:null,mapWidth:0,mapHeight:0,mapRatio:0,startX:0,startY:0,borderCorrection:0},this.globals.style={opacity:.2,fillColor:"#000",border:"2px solid blue"};var n=this.globals.style;for(var a in e)n[a]=e[a];var i=n.border.split(" ");n.outlineWidth=parseInt(i[0].replace(/\D/g,"")),n.outlineColor=i[2],n.alphaIE="alpha(opacity="+100*n.opacity+")",this.globals.backStack=[],this.globals.options={buttonHTML:"zoom ...",buttonStartingStyle:{width:"52px",border:"1px solid black",padding:"2px"},buttonStyle:{background:"#FFF"},backButtonHTML:"zoom back",backButtonStyle:{background:"#FFF",display:"none"},buttonZoomingHTML:"Drag a region on the map",buttonZoomingStyle:{background:"#FF0"},overlayRemoveTime:6e3,backButtonEnabled:!1,stickyZoomEnabled:!1,rightMouseZoomOutEnabled:!1,minDragSize:0};for(var a in t)this.globals.options[a]=t[a];null==o&&(o={}),this.globals.callbacks=o}DragZoomControl.prototype=new GControl,DragZoomControl.prototype.saveMapContext=function(e){this.globals.options.backButtonEnabled&&(this.saveBackContext_(e,!0),this.globals.backButtonDiv.style.display="block")},DragZoomControl.prototype.initiateZoom=function(){this.buttonclick_()},DragZoomControl.prototype.initiateZoomBack=function(){this.globals.options.backButtonEnabled&&this.backbuttonclick_()},DragZoomControl.prototype.initButton_=function(e){var t=this.globals,o=document.createElement("div");return o.innerHTML=t.options.buttonHTML,DragZoomUtil.style([o],{cursor:"pointer",zIndex:200}),DragZoomUtil.style([o],t.options.buttonStartingStyle),DragZoomUtil.style([o],t.options.buttonStyle),e.appendChild(o),o},DragZoomControl.prototype.initBackButton_=function(e){var t=this.globals,o=document.createElement("div");return o.innerHTML=t.options.backButtonHTML,DragZoomUtil.style([o],{cursor:"pointer",zIndex:200}),DragZoomUtil.style([o],t.options.buttonStartingStyle),DragZoomUtil.style([o],t.options.backButtonStyle),e.appendChild(o),o},DragZoomControl.prototype.setButtonMode_=function(e){var t=this.globals;"zooming"==e?(t.buttonDiv.innerHTML=t.options.buttonZoomingHTML,DragZoomUtil.style([t.buttonDiv],t.options.buttonStartingStyle),DragZoomUtil.style([t.buttonDiv],t.options.buttonZoomingStyle)):(t.buttonDiv.innerHTML=t.options.buttonHTML,DragZoomUtil.style([t.buttonDiv],t.options.buttonStartingStyle),DragZoomUtil.style([t.buttonDiv],t.options.buttonStyle))},DragZoomControl.prototype.initialize=function(e){var t=this.globals,o=this,n=e.getContainer(),a=document.createElement("div");DragZoomUtil.style([a],{cursor:"pointer",zIndex:150});var i=this.initButton_(a),r=this.initBackButton_(a);n.appendChild(a);for(var s=document.createElement("div"),l=["outlineDiv","cornerTopDiv","cornerLeftDiv","cornerRightDiv","cornerBottomDiv"],p=0;p<l.length;p++){var c=l[p],d=document.createElement("div");DragZoomUtil.style([d],{position:"absolute",display:"none"}),s.appendChild(d),t[c]=d}return DragZoomUtil.style([s],{position:"absolute",display:"none",overflow:"hidden",cursor:"crosshair",zIndex:101}),n.appendChild(s),GEvent.addDomListener(i,"click",function(e){o.buttonclick_(e)}),GEvent.addDomListener(r,"click",function(e){o.backbuttonclick_(e)}),GEvent.addDomListener(s,"mousedown",function(e){o.coverMousedown_(e)}),GEvent.addDomListener(document,"mousemove",function(e){o.drag_(e)}),GEvent.addDomListener(document,"mouseup",function(e){o.mouseup_(e)}),t.mapPosition=DragZoomUtil.getElementPosition(n),t.buttonDiv=i,t.backButtonDiv=r,t.mapCover=s,t.map=e,t.borderCorrection=2*t.style.outlineWidth,this.setDimensions_(),this.initStyles_(),t.mapCover.onselectstart=function(){return!1},a},DragZoomControl.prototype.getDefaultPosition=function(){return new GControlPosition(G_ANCHOR_TOP_LEFT,new GSize(3,120))},DragZoomControl.prototype.coverMousedown_=function(e){var t=this.globals,o=this.getRelPos_(e);if(t.startX=o.left,t.startY=o.top,e.which)var n=1!=e.which;else if(e.button)var n=1!=e.button;return t.draggingRightMouse=n,DragZoomUtil.style([t.mapCover],{background:"transparent",opacity:1,filter:"alpha(opacity=100)"}),DragZoomUtil.style([t.outlineDiv],{left:t.startX+"px",top:t.startY+"px",display:"block",width:"1px",height:"1px"}),t.draggingOn=!0,t.cornerTopDiv.style.top=t.startY-t.mapHeight+"px",t.cornerTopDiv.style.display="block",t.cornerLeftDiv.style.left=t.startX-t.mapWidth+"px",t.cornerLeftDiv.style.top=t.startY+"px",t.cornerLeftDiv.style.display="block",t.cornerRightDiv.style.left=t.startX+"px",t.cornerRightDiv.style.top=t.startY+"px",t.cornerRightDiv.style.display="block",t.cornerBottomDiv.style.left=t.startX+"px",t.cornerBottomDiv.style.top=t.startY+"px",t.cornerBottomDiv.style.width="0px",t.cornerBottomDiv.style.display="block",null!=t.callbacks.dragstart&&t.callbacks.dragstart(t.startX,t.startY),!1},DragZoomControl.prototype.drag_=function(e){var t=this.globals;if(t.draggingOn){var o=this.getRelPos_(e),n=this.getRectangle_(t.startX,t.startY,o,t.mapRatio);return addX=n.left?-n.width:0,addY=n.top?-n.height:0,DragZoomUtil.style([t.outlineDiv],{left:t.startX+addX+"px",top:t.startY+addY+"px",display:"block",width:"1px",height:"1px"}),t.outlineDiv.style.width=n.width+"px",t.outlineDiv.style.height=n.height+"px",t.cornerTopDiv.style.height=t.startY+addY-(t.startY-t.mapHeight)+"px",t.cornerLeftDiv.style.top=t.startY+addY+"px",t.cornerLeftDiv.style.width=t.startX+addX-(t.startX-t.mapWidth)+"px",t.cornerRightDiv.style.top=t.cornerLeftDiv.style.top,t.cornerRightDiv.style.left=t.startX+addX+n.width+t.borderCorrection+"px",t.cornerBottomDiv.style.top=t.startY+addY+n.height+t.borderCorrection+"px",t.cornerBottomDiv.style.left=t.startX-t.mapWidth+(t.startX+addX-(t.startX-t.mapWidth))+"px",t.cornerBottomDiv.style.width=n.width+t.borderCorrection+"px",null!=t.callbacks.dragging&&t.callbacks.dragging(t.startX,t.startY,n.endX,n.endY),!1}},DragZoomControl.prototype.mouseup_=function(e){var t=this.globals;if(t.draggingOn){var o=this.getRelPos_(e);t.draggingOn=!1;var n=this.getRectangle_(t.startX,t.startY,o,t.mapRatio);if(n.left&&(n.endX=n.startX-n.width),n.top&&(n.endY=n.startY-n.height),this.resetDragZoom_(),n.width>=t.options.minDragSize&&n.height>=t.options.minDragSize){var a=new GPoint(n.startX,n.startY),i=new GPoint(n.endX,n.startY),r=new GPoint(n.endX,n.endY),s=new GPoint(n.startX,n.endY),l=t.map.fromContainerPixelToLatLng(a),p=t.map.fromContainerPixelToLatLng(i),c=t.map.fromContainerPixelToLatLng(r),d=t.map.fromContainerPixelToLatLng(s),u=new GPolyline([l,p,c,d,l],t.style.outlineColor,t.style.outlineWidth+1,.4);try{t.map.addOverlay(u),setTimeout(function(){t.map.removeOverlay(u)},t.options.overlayRemoveTime)}catch(e){}var h=u.getBounds(),p=h.getNorthEast(),d=h.getSouthWest(),c=new GLatLng(d.lat(),p.lng()),l=new GLatLng(p.lat(),d.lng());if(t.options.rightMouseZoomOutEnabled&&t.draggingRightMouse)var g=t.map.getBounds().toSpan(),m=h.toSpan(),f=Math.max(g.lat()/m.lat(),g.lng()/m.lng()),v=t.map.getZoom()-Math.ceil(Math.log(f,2));else var v=t.map.getBoundsZoomLevel(h);var y=h.getCenter();t.map.setCenter(y,v),null!=t.callbacks.dragend&&t.callbacks.dragend(l,p,c,d,a,i,r,s)}t.options.stickyZoomEnabled&&(this.initCover_(),t.options.backButtonEnabled&&this.saveBackContext_(t.options.backButtonHTML,!1),t.backButtonDiv.style.display="none")}},DragZoomControl.prototype.setDimensions_=function(){var e=this.globals,t=e.map.getSize();e.mapWidth=t.width,e.mapHeight=t.height,e.mapRatio=e.mapHeight/e.mapWidth,DragZoomUtil.style([e.mapCover,e.cornerTopDiv,e.cornerRightDiv,e.cornerBottomDiv,e.cornerLeftDiv],{top:"0px",left:"0px",width:e.mapWidth+"px",height:e.mapHeight+"px"})},DragZoomControl.prototype.initStyles_=function(){var e=this.globals;DragZoomUtil.style([e.mapCover,e.cornerTopDiv,e.cornerRightDiv,e.cornerBottomDiv,e.cornerLeftDiv],{filter:e.style.alphaIE,opacity:e.style.opacity,background:e.style.fillColor}),e.outlineDiv.style.border=e.style.border},DragZoomControl.prototype.buttonclick_=function(){var e=this.globals;e.backButtonDiv.style.display="none","block"==e.mapCover.style.display?(this.resetDragZoom_(),e.options.backButtonEnabled&&(this.restoreBackContext_(),0==e.backStack.length&&(e.backButtonDiv.style.display="none"))):(this.initCover_(),e.options.backButtonEnabled&&this.saveBackContext_(e.options.backButtonHTML,!1))},DragZoomControl.prototype.backbuttonclick_=function(){var e=this.globals;e.options.backButtonEnabled&&e.backStack.length>0&&(this.restoreBackContext_(),null!=e.callbacks.backbuttonclick&&e.callbacks.backbuttonclick(e.methodCall))},DragZoomControl.prototype.saveBackContext_=function(e,t){var o=this.globals,n={};n.center=o.map.getCenter(),n.zoom=o.map.getZoom(),n.maptype=o.map.getCurrentMapType(),n.text=o.backButtonDiv.innerHTML,n.methodCall=t,o.backStack.push(n),o.backButtonDiv.innerHTML=e},DragZoomControl.prototype.restoreBackContext_=function(){var e=this.globals,t=e.backStack.pop();e.map.setCenter(t.center,t.zoom,t.maptype),e.backButtonDiv.innerHTML=t.text,e.methodCall=t.methodCall,0==e.backStack.length&&(e.backButtonDiv.style.display="none")},DragZoomControl.prototype.initCover_=function(){var e=this.globals;e.mapPosition=DragZoomUtil.getElementPosition(e.map.getContainer()),this.setDimensions_(),this.setButtonMode_("zooming"),DragZoomUtil.style([e.mapCover],{display:"block",background:e.style.fillColor}),DragZoomUtil.style([e.outlineDiv],{width:"0px",height:"0px"}),null!=e.callbacks.buttonclick&&e.callbacks.buttonclick()},DragZoomControl.prototype.getRelPos_=function(e){var t=DragZoomUtil.getMousePosition(e),o=this.globals;return{top:t.top-o.mapPosition.top,left:t.left-o.mapPosition.left}},DragZoomControl.prototype.getRectangle_=function(e,t,o,n){var a=!1,i=!1,r=o.left-e,s=o.top-t;return 0>r&&(r=-1*r,a=!0),0>s&&(s=-1*s,i=!0),delta=r>s?r:s,{startX:e,startY:t,endX:e+delta,endY:t+parseInt(delta*n),width:delta,height:parseInt(delta*n),left:a,top:i}},DragZoomControl.prototype.resetDragZoom_=function(){var e=this.globals;DragZoomUtil.style([e.mapCover,e.cornerTopDiv,e.cornerRightDiv,e.cornerBottomDiv,e.cornerLeftDiv],{display:"none",opacity:e.style.opacity,filter:e.style.alphaIE}),e.outlineDiv.style.display="none",this.setButtonMode_("normal"),e.options.backButtonEnabled&&e.backStack.length>0&&(e.backButtonDiv.style.display="block")};var DragZoomUtil={};DragZoomUtil.gE=function(e){return document.getElementById(e)},DragZoomUtil.getMousePosition=function(e){var t=0,o=0;if(!e)var e=window.event;return e.pageX||e.pageY?(t=e.pageX,o=e.pageY):(e.clientX||e.clientY)&&(t=e.clientX+(document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft),o=e.clientY+(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop)),{left:t,top:o}},DragZoomUtil.getElementPosition=function(e){for(var t=e.offsetLeft,o=e.offsetTop,n=e.offsetParent;null!=n;)t+=n.offsetLeft,o+=n.offsetTop,n=n.offsetParent;return{left:t,top:o}},DragZoomUtil.style=function(e,t){"string"==typeof e&&(e=DragZoomUtil.getManyElements(e));for(var o=0;o<e.length;o++)for(var n in t)e[o].style[n]=t[n]},DragZoomUtil.getManyElements=function(e){for(var t=e.split(","),o=[],n=0;n<t.length;n++)o[o.length]=DragZoomUtil.gE(t[n]);return o};