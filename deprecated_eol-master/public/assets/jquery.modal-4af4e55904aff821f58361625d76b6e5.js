!function(e){e.fn.modal=function(t){function i(){e(document).bind("keyup",function(t){27===t.keyCode&&e(u.modal).is(":visible")&&(a(e(u.modal),e(u.modal_layer)),e(document).unbind(t))})}function n(){var t=function(t,i,n){return t.attributes={id:"#"===u[i].charAt(0)?u[i].substring(1):null,"class":"."===u[i].charAt(0)?u[i].substring(1):null},e(n,t.attributes).appendTo(document.body)};return p.length||(p=t(p,"modal",u.modal_container)),d.length||(d=t(d,"modal_layer","<div />")),u.modal_class&&p.addClass(u.modal_class),p}function s(){p.css(e.extend({left:"50%",marginLeft:-(p.outerWidth()/2)},u.position))}function o(){return h=e(this),"function"==typeof u.beforeSend&&u.beforeSend(h),n.apply(this),s(),i(),r(),!1}function r(){p.innerHeight()>window.innerHeight?p.css({position:"absolute",top:u.position.top||window.pageYOffset+20}):p.css({position:"fixed",top:u.position.top||20}),u.align_to_trigger&&u.align_to_trigger in f&&(p.css("position","absolute"),f[u.align_to_trigger]()),"function"==typeof u.beforeShow&&u.beforeShow.apply(h),d.data("original_opacity")||d.data("original_opacity",d.css("opacity")),d.show().css({opacity:0}).animate({opacity:d.data("original_opacity")},u.duration),p.show().css({opacity:0}).animate({opacity:1},u.duration,function(){"function"==typeof u.ajaxCallback&&u.ajaxCallback.apply(h)}),e(u.modal_layer+", "+u.modal+" a.close").live("click",function(){return a(p,d),!1}),p.trigger("modal_open")}function a(){for(var e=0;e<arguments.length;e++)arguments[e].fadeOut(u.duration,function(){"function"==typeof u.afterClose&&u.afterClose(),u.modal_class&&p.removeClass(u.modal_class)})}function l(){p=e(u.modal),d=e(u.modal_layer),h=e(this),"function"==typeof u.beforeSend&&u.beforeSend(),n.apply(this),s(),i(),p.empty();var t=h.attr("rel")?h.attr("href")+" "+h.attr("rel"):h.attr("href");if(/.+\.(png|jpg|jpeg|gif)(\?.+)?$/i.test(t)){var o=new Image;o.src=t,o.onload=function(){o.width>p.width()&&(o.width=p.width()),p.html(o).css({width:o.width,left:"50%",marginLeft:-(o.width/2)}),r()}}else p.load(t,r);return!1}var c={ajax:!0,duration:500,position:{},modal_layer:"#modal_layer",modal_container:"<div />",modal:"#modal",modal_class:null,ajaxCallback:null,beforeSend:null,beforeShow:null,afterClose:null,bind_type:"live",align_to_trigger:null},u=e.extend(c,t);u.left=(parseInt(e("body").width())-u.width)/2;var h,d=e(u.modal_layer),p=e(u.modal),f={top:function(){p.css("top",h.offset().top)},bottom:function(){var e=h.offset().top-p.innerHeight();0>e&&(e=u.position.top||0),p.css("top",e)},middle:function(){var e=h.offset().top-p.innerHeight()/2;0>e&&(e=u.position.top||0),p.css("top",e)}};return this[u.bind_type]("click.modal",u.ajax?l:o)}}(jQuery);