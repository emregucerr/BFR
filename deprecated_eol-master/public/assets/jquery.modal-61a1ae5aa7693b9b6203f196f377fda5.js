!function(e){e.fn.modal=function(t){function i(){e(document).bind("keyup",function(t){27===t.keyCode&&e(u.modal).is(":visible")&&(a(e(u.modal),e(u.modal_layer)),e(document).unbind(t))})}function n(){var t=function(t,i,n){return t.attributes={id:"#"===u[i].charAt(0)?u[i].substring(1):null,"class":"."===u[i].charAt(0)?u[i].substring(1):null},e(n,t.attributes).appendTo(document.body)};return f.length||(f=t(f,"modal",u.modal_container)),d.length||(d=t(d,"modal_layer","<div />")),u.modal_class&&f.addClass(u.modal_class),f}function s(){f.css(e.extend({left:"50%",marginLeft:-(f.outerWidth()/2)},u.position))}function o(){return h=e(this),"function"==typeof u.beforeSend&&u.beforeSend(h),n.apply(this),s(),i(),r(),!1}function r(){f.innerHeight()>window.innerHeight?f.css({position:"absolute",top:u.position.top||window.pageYOffset+20}):f.css({position:"fixed",top:u.position.top||20}),u.align_to_trigger&&u.align_to_trigger in p&&(f.css("position","absolute"),p[u.align_to_trigger]()),"function"==typeof u.beforeShow&&u.beforeShow.apply(h),d.data("original_opacity")||d.data("original_opacity",d.css("opacity")),d.show().css({opacity:0}).animate({opacity:d.data("original_opacity")},u.duration),f.show().css({opacity:0}).animate({opacity:1},u.duration,function(){"function"==typeof u.ajaxCallback&&u.ajaxCallback.apply(h)}),e(u.modal_layer+", "+u.modal+" a.close").live("click",function(){return a(f,d),!1}),f.trigger("modal_open")}function a(){for(var e=0;e<arguments.length;e++)arguments[e].fadeOut(u.duration,function(){"function"==typeof u.afterClose&&u.afterClose(),u.modal_class&&f.removeClass(u.modal_class)})}function l(){f=e(u.modal),d=e(u.modal_layer),h=e(this),"function"==typeof u.beforeSend&&u.beforeSend(),n.apply(this),s(),i(),f.empty();var t=h.attr("rel")?h.attr("href")+" "+h.attr("rel"):h.attr("href");if(/.+\.(png|jpg|jpeg|gif)(\?.+)?$/i.test(t)){var o=new Image;o.src=t,o.onload=function(){o.width>f.width()&&(o.width=f.width()),f.html(o).css({width:o.width,left:"50%",marginLeft:-(o.width/2)}),r()}}else f.load(t,r);return!1}var c={ajax:!0,duration:500,position:{},modal_layer:"#modal_layer",modal_container:"<div />",modal:"#modal",modal_class:null,ajaxCallback:null,beforeSend:null,beforeShow:null,afterClose:null,bind_type:"live",align_to_trigger:null},u=e.extend(c,t);u.left=(parseInt(e("body").width())-u.width)/2;var h,d=e(u.modal_layer),f=e(u.modal),p={top:function(){f.css("top",h.offset().top)},bottom:function(){var e=h.offset().top-f.innerHeight();0>e&&(e=u.position.top||0),f.css("top",e)},middle:function(){var e=h.offset().top-f.innerHeight()/2;0>e&&(e=u.position.top||0),f.css("top",e)}};return this[u.bind_type]("click.modal",u.ajax?l:o)}}(jQuery);