function clustersOnOff(){$("goRadioText").innerHTML="Clusters ON"==$("goRadioText").innerHTML?"Clusters OFF":"Clusters ON",EoLMap.change()}function get_center_lat_long(){var e=new google.maps.LatLngBounds;EoLMap.recs=data.records;for(var t=EoLMap.recs.length,i=0;t>i;i++)e.extend(new google.maps.LatLng(EoLMap.recs[i].h,EoLMap.recs[i].i));return e.getCenter()}function goFullScreen(){currCenter=EoLMap.map.getCenter();var e=document.getElementById("gmap");document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?($("goFullText").innerHTML="Fullscreen OFF","Panel ON"==$("goPanelText").innerHTML?($("panel").style.height="500px",$("panel").style.width="200px",$("map-canvas").style.height="500px",$("map-canvas").style.width="700px"):($("panel").style.height="0px",$("panel").style.width="0px",$("map-canvas").style.height="500px",$("map-canvas").style.width="900px"),document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&(e.style.width="",document.webkitExitFullscreen())):($("goFullText").innerHTML="Fullscreen ON","Panel ON"==$("goPanelText").innerHTML?($("panel").style.height="100%",$("panel").style.width="17%",$("map-canvas").style.height="100%",$("map-canvas").style.width="83%"):($("panel").style.height="0px",$("panel").style.width="0px",$("map-canvas").style.height="100%",$("map-canvas").style.width="100%"),e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&(e.style.width="100%",e.style.height="100%",e.webkitRequestFullscreen())),google.maps.event.trigger(EoLMap.map,"resize"),EoLMap.map.setCenter(currCenter)}function exitHandler(){if(is_full_screen){if(!document.webkitIsFullScreen){$("goFullText").innerHTML="Fullscreen OFF";var e=document.getElementById("gmap");e.style.width=""}document.mozFullScreen&&($("goFullText").innerHTML="Fullscreen ON")}is_full_screen()||("Panel ON"==$("goPanelText").innerHTML?($("panel").style.height="500px",$("panel").style.width="200px",$("map-canvas").style.height="500px",$("map-canvas").style.width="700px"):($("map-canvas").style.height="500px",$("map-canvas").style.width="900px")),google.maps.event.trigger(EoLMap.map,"resize"),EoLMap.map.setCenter(currCenter)}function is_full_screen(){var e=document.getElementById("gmap");if(e.requestFullscreen);else if(e.msRequestFullscreen){if(1==document.msFullscreenElement)return!0}else if(e.mozRequestFullScreen){if(1==document.mozFullScreen)return!0}else if(e.webkitRequestFullscreen&&1==document.webkitIsFullScreen)return!0;return!1}function panelShowHide(){$("goPanelText").innerHTML="Panel ON"==$("goPanelText").innerHTML?"Panel OFF":"Panel ON",is_full_screen()?($("map-canvas").style.height="100%","Panel ON"==$("goPanelText").innerHTML?($("panel").style.width="17%",$("panel").style.height="100%",$("map-canvas").style.width="83%"):($("panel").style.width="0px",$("panel").style.height="0px",$("map-canvas").style.width="100%")):($("map-canvas").style.height="500px","Panel ON"==$("goPanelText").innerHTML?($("panel").style.width="200px",$("panel").style.height="500px",$("map-canvas").style.width="700px"):($("panel").style.width="0px",$("panel").style.height="0px",$("map-canvas").style.width="900px")),currCenter=EoLMap.map.getCenter(),google.maps.event.trigger(EoLMap.map,"resize"),EoLMap.map.setCenter(currCenter)}function record_history(){var e={};e.center=EoLMap.map.getCenter(),e.zoom=EoLMap.map.getZoom(),e.mapTypeId=EoLMap.map.getMapTypeId(),statuz.push(e),statuz_all.push(e),initial_map||(initial_map=e),currCenter=EoLMap.map.getCenter()}function CenterControl(e,t,i){var n=document.createElement("div");n.id="goBackUI",n.title="Go back one step",e.appendChild(n);var s=document.createElement("div");s.id="goBackText",s.innerHTML="Go Back",n.appendChild(s);var a=document.createElement("div");a.id="goNextUI",a.title="Move forward one step",e.appendChild(a);var o=document.createElement("div");o.id="goNextText",o.innerHTML="Move Next",a.appendChild(o);var r=document.createElement("div");r.id="goOrigUI",r.title="Back to original map",e.appendChild(r);var l=document.createElement("div");if(l.id="goOrigText",l.innerHTML="Initial Map",r.appendChild(l),1==i){var c=document.createElement("div");c.id="goRadioUI",c.title="Toggle Clustering",e.appendChild(c);var u=document.createElement("div");u.id="goRadioText",u.innerHTML="Clusters ON",c.appendChild(u),c.addEventListener("click",function(){clustersOnOff()})}var h=document.createElement("div");h.id="goPanelUI",h.title="Toggle Panel",e.appendChild(h);var d=document.createElement("div");d.id="goPanelText",d.innerHTML="Panel OFF",h.appendChild(d);var p=document.createElement("div");p.id="goFullUI",p.title="Toggle Fullscreen",e.appendChild(p);var f=document.createElement("div");f.id="goFullText",f.innerHTML="Fullscreen OFF",p.appendChild(f),n.addEventListener("click",function(){EoLMap.back()}),a.addEventListener("click",function(){EoLMap.next()}),r.addEventListener("click",function(){EoLMap.map.setOptions(initial_map),statuz=[],statuz_all=[]}),h.addEventListener("click",function(){panelShowHide()}),p.addEventListener("click",function(){goFullScreen()})}var EoLMap={};EoLMap.recs=null,EoLMap.map=null,EoLMap.markerClusterer=null,EoLMap.markers=[],EoLMap.infoWindow=null;var markerSpiderfier=null,statuz=[],statuz_all=[],initial_map=!1;EoLMap.init=function(){center_latlong=get_center_lat_long();var e=new google.maps.LatLng(center_latlong.lat(),center_latlong.lng()),t={zoom:2,center:e,mapTypeId:google.maps.MapTypeId.ROADMAP,scaleControl:!0};EoLMap.map=new google.maps.Map($("map-canvas"),t);{var i=document.createElement("div");new CenterControl(i,EoLMap.map,1)}i.index=1,i.style["padding-top"]="10px",EoLMap.map.controls[google.maps.ControlPosition.TOP_CENTER].push(i),EoLMap.recs=data.records,$("total_markers").innerHTML=data.actual+"<br>Plotted: "+data.count,EoLMap.map.enableKeyDragZoom();var n={keepSpiderfied:!0,event:"mouseover"};markerSpiderfier=new OverlappingMarkerSpiderfier(EoLMap.map,n),EoLMap.infoWindow=new google.maps.InfoWindow,EoLMap.showMarkers(),google.maps.event.addListener(EoLMap.map,"idle",function(){record_history()})},EoLMap.showMarkers=function(){EoLMap.markers=[],EoLMap.markerClusterer&&EoLMap.markerClusterer.clearMarkers();var e=$("markerlist");e.innerHTML="";for(var t=EoLMap.recs.length,i=0;t>i;i++){var n=EoLMap.recs[i].a;""===n&&(n="No catalog number");var s=document.createElement("DIV"),a=document.createElement("A");a.href="#",a.className="title",a.innerHTML=n,s.appendChild(a),e.appendChild(s);var o=new google.maps.LatLng(EoLMap.recs[i].h,EoLMap.recs[i].i),r=new google.maps.Marker({position:o,icon:"https://storage.googleapis.com/support-kms-prod/SNP_2752125_en_v0"}),l=EoLMap.markerClickFunction(EoLMap.recs[i],o);google.maps.event.addListener(r,"click",l),google.maps.event.addDomListener(a,"click",l),EoLMap.markers.push(r),markerSpiderfier.addMarker(r)}markerSpiderfier.addListener("click",function(e){EoLMap.infoWindow.open(EoLMap.map,e)}),markerx=EoLMap.markers,markerSpiderfier.addListener("spiderfy",function(){EoLMap.infoWindow.close()}),window.setTimeout(EoLMap.time,0)},EoLMap.markerClickFunction=function(e,t){return function(i){i.cancelBubble=!0,i.returnValue=!1,i.stopPropagation&&(i.stopPropagation(),i.preventDefault());var n=e.b,s='<div class="info"><h3>'+n+"</h3>";e.l&&(s+='<div class="info-body"><img src="'+e.l+'" class="info-img"/></div><br/>'),e.a&&(s+="Catalog number: "+e.a+"<br/>"),s+='Source portal: <a href="http://www.gbif.org/occurrence/'+e.g+'" target="_blank">GBIF data</a><br/>Publisher: <a href="http://www.gbif.org/publisher/'+e.d+'" target="_blank">'+e.c+'</a><br/>Dataset: <a href="http://www.gbif.org/dataset/'+e.f+'" target="_blank">'+e.e+"</a><br/>",e.j&&(s+="Recorded by: "+e.j+"<br/>"),e.k&&(s+="Identified by: "+e.k+"<br/>"),e.m&&(s+="Event date: "+e.m+"<br/>"),s+="</div>",EoLMap.infoWindow.setContent(s),EoLMap.infoWindow.setPosition(t),EoLMap.infoWindow.open(EoLMap.map)}},EoLMap.clear=function(){for(var e,t=0;e=EoLMap.markers[t];t++)e.setMap(null)},EoLMap.change=function(){EoLMap.clear(),EoLMap.showMarkers()},EoLMap.time=function(){if(document.getElementById("goRadioText"))if("Clusters ON"==$("goRadioText").innerHTML)EoLMap.markerClusterer=new MarkerClusterer(EoLMap.map,EoLMap.markers);else for(var e,t=0;e=EoLMap.markers[t];t++)e.setMap(EoLMap.map);else EoLMap.markerClusterer=new MarkerClusterer(EoLMap.map,EoLMap.markers)};var currCenter="";document.addEventListener&&(document.addEventListener("webkitfullscreenchange",exitHandler,!1),document.addEventListener("mozfullscreenchange",exitHandler,!1),document.addEventListener("fullscreenchange",exitHandler,!1),document.addEventListener("MSFullscreenChange",exitHandler,!1)),EoLMap.back=function(){if(statuz.length>1){statuz.pop();var e=statuz.pop();EoLMap.map.setOptions(e),JSON.stringify(e)==JSON.stringify(initial_map)&&(statuz=[],statuz_all=[])}},EoLMap.next=function(){if(statuz_all.length>1){statuz_all.pop();var e=statuz_all.pop();EoLMap.map.setOptions(e),JSON.stringify(e)==JSON.stringify(initial_map)&&(statuz=[],statuz_all=[])}},$(document).ready(function(){EoLMap.init()});