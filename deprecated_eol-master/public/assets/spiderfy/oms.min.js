(function(){/*
 OverlappingMarkerSpiderfier
https://github.com/jawj/OverlappingMarkerSpiderfier
Copyright (c) 2011 - 2012 George MacKerron
Released under the MIT licence: http://opensource.org/licenses/mit-license
Note: The Google Maps API v3 must be included *before* this code
*/
var t=!0,e=null,r=!1;(function(){var o,i={}.hasOwnProperty,n=[].slice;((o=this.google)!=e?o.maps:void 0)!=e&&(this.OverlappingMarkerSpiderfier=function(){function o(t,r){var o,n,s,l,p=this;this.map=t,r==e&&(r={});for(o in r)i.call(r,o)&&(n=r[o],this[o]=n);for(this.e=new this.constructor.g(this.map),this.n(),this.b={},l=["click","zoom_changed","maptypeid_changed"],n=0,s=l.length;s>n;n++)o=l[n],a.addListener(this.map,o,function(){return p.unspiderfy()})}var a,s,l,p,h,u,c,d;for(u=o.prototype,d=[o,u],p=0,h=d.length;h>p;p++)l=d[p],l.VERSION="0.3.3";return s=google.maps,a=s.event,h=s.MapTypeId,c=2*Math.PI,u.keepSpiderfied=r,u.markersWontHide=r,u.markersWontMove=r,u.nearbyDistance=20,u.circleSpiralSwitchover=9,u.circleFootSeparation=23,u.circleStartAngle=c/12,u.spiralFootSeparation=26,u.spiralLengthStart=11,u.spiralLengthFactor=4,u.spiderfiedZIndex=1e3,u.usualLegZIndex=10,u.highlightedLegZIndex=20,u.legWeight=1.5,u.legColors={usual:{},highlighted:{}},p=u.legColors.usual,l=u.legColors.highlighted,p[h.HYBRID]=p[h.SATELLITE]="#fff",l[h.HYBRID]=l[h.SATELLITE]="#f00",p[h.TERRAIN]=p[h.ROADMAP]="#444",l[h.TERRAIN]=l[h.ROADMAP]="#f00",u.n=function(){this.a=[],this.j=[]},u.addMarker=function(o){var i,n=this;return o._oms!=e?this:(o._oms=t,i=[a.addListener(o,"click",function(t){return n.F(o,t)})],this.markersWontHide||i.push(a.addListener(o,"visible_changed",function(){return n.o(o,r)})),this.markersWontMove||i.push(a.addListener(o,"position_changed",function(){return n.o(o,t)})),this.j.push(i),this.a.push(o),this)},u.o=function(t,r){return t._omsData==e||!r&&t.getVisible()||this.s!=e||this.t!=e?void 0:this.unspiderfy(r?t:e)},u.getMarkers=function(){return this.a.slice(0)},u.removeMarker=function(t){var r,o,i,n,s;if(t._omsData!=e&&this.unspiderfy(),r=this.m(this.a,t),0>r)return this;for(i=this.j.splice(r,1)[0],n=0,s=i.length;s>n;n++)o=i[n],a.removeListener(o);return delete t._oms,this.a.splice(r,1),this},u.clearMarkers=function(){var t,e,r,o,i,n,s,l;for(this.unspiderfy(),l=this.a,t=o=0,n=l.length;n>o;t=++o){for(r=l[t],e=this.j[t],i=0,s=e.length;s>i;i++)t=e[i],a.removeListener(t);delete r._oms}return this.n(),this},u.addListener=function(t,r){var o,i;return((i=(o=this.b)[t])!=e?i:o[t]=[]).push(r),this},u.removeListener=function(t,e){var r;return r=this.m(this.b[t],e),0>r||this.b[t].splice(r,1),this},u.clearListeners=function(t){return this.b[t]=[],this},u.trigger=function(){var t,r,o,i,a,s;for(r=arguments[0],t=2<=arguments.length?n.call(arguments,1):[],r=(o=this.b[r])!=e?o:[],s=[],i=0,a=r.length;a>i;i++)o=r[i],s.push(o.apply(e,t));return s},u.u=function(t,e){var r,o,i,n,a;for(i=this.circleFootSeparation*(2+t)/c,o=c/t,a=[],r=n=0;t>=0?t>n:n>t;r=t>=0?++n:--n)r=this.circleStartAngle+r*o,a.push(new s.Point(e.x+i*Math.cos(r),e.y+i*Math.sin(r)));return a},u.v=function(t,e){var r,o,i,n,a;for(i=this.spiralLengthStart,r=0,a=[],o=n=0;t>=0?t>n:n>t;o=t>=0?++n:--n)r+=this.spiralFootSeparation/i+5e-4*o,o=new s.Point(e.x+i*Math.cos(r),e.y+i*Math.sin(r)),i+=c*this.spiralLengthFactor/r,a.push(o);return a},u.F=function(t,r){var o,i,n,a,s,l,p,h,u;if(a=t._omsData!=e,(!a||!this.keepSpiderfied)&&this.unspiderfy(),a||this.map.getStreetView().getVisible()||"GoogleEarthAPI"===this.map.getMapTypeId())return this.trigger("click",t,r);for(a=[],s=[],o=this.nearbyDistance,l=o*o,n=this.c(t.position),u=this.a,p=0,h=u.length;h>p;p++)o=u[p],o.map!=e&&o.getVisible()&&(i=this.c(o.position),this.f(i,n)<l?a.push({A:o,p:i}):s.push(o));return 1===a.length?this.trigger("click",t,r):this.G(a,s)},u.markersNearMarker=function(t,o){var i,n,a,s,l,p,h,u,c,d;if(o==e&&(o=r),this.e.getProjection()==e)throw"Must wait for 'idle' event on map before calling markersNearMarker";for(i=this.nearbyDistance,l=i*i,a=this.c(t.position),s=[],u=this.a,p=0,h=u.length;h>p&&(i=u[p],i===t||i.map==e||!i.getVisible()||(n=this.c((c=(d=i._omsData)!=e?d.l:void 0)!=e?c:i.position),!(this.f(n,a)<l&&(s.push(i),o))));p++);return s},u.markersNearAnyOtherMarker=function(){var o,i,n,a,s,l,p,h,u,c,d,g;if(this.e.getProjection()==e)throw"Must wait for 'idle' event on map before calling markersNearAnyOtherMarker";for(l=this.nearbyDistance,o=l*l,a=this.a,l=[],d=0,n=a.length;n>d;d++)i=a[d],l.push({q:this.c((p=(u=i._omsData)!=e?u.l:void 0)!=e?p:i.position),d:r});for(d=this.a,i=p=0,u=d.length;u>p;i=++p)if(n=d[i],n.map!=e&&n.getVisible()&&(a=l[i],!a.d))for(g=this.a,n=h=0,c=g.length;c>h;n=++h)if(s=g[n],n!==i&&s.map!=e&&s.getVisible()&&(s=l[n],(!(i>n)||s.d)&&this.f(a.q,s.q)<o)){a.d=s.d=t;break}for(d=this.a,n=[],o=p=0,u=d.length;u>p;o=++p)i=d[o],l[o].d&&n.push(i);return n},u.z=function(t){var e=this;return{h:function(){return t._omsData.i.setOptions({strokeColor:e.legColors.highlighted[e.map.mapTypeId],zIndex:e.highlightedLegZIndex})},k:function(){return t._omsData.i.setOptions({strokeColor:e.legColors.usual[e.map.mapTypeId],zIndex:e.usualLegZIndex})}}},u.G=function(e,r){var o,i,n,l,p,h,u,c,d,g;return this.s=t,g=e.length,o=this.C(function(){var t,r,o;for(o=[],t=0,r=e.length;r>t;t++)c=e[t],o.push(c.p);return o}()),l=g>=this.circleSpiralSwitchover?this.v(g,o).reverse():this.u(g,o),o=function(){var t,r,o,c=this;for(o=[],t=0,r=l.length;r>t;t++)n=l[t],i=this.D(n),d=this.B(e,function(t){return c.f(t.p,n)}),u=d.A,h=new s.Polyline({map:this.map,path:[u.position,i],strokeColor:this.legColors.usual[this.map.mapTypeId],strokeWeight:this.legWeight,zIndex:this.usualLegZIndex}),u._omsData={l:u.position,i:h},this.legColors.highlighted[this.map.mapTypeId]!==this.legColors.usual[this.map.mapTypeId]&&(p=this.z(u),u._omsData.w={h:a.addListener(u,"mouseover",p.h),k:a.addListener(u,"mouseout",p.k)}),u.setPosition(i),u.setZIndex(Math.round(this.spiderfiedZIndex+n.y)),o.push(u);return o}.call(this),delete this.s,this.r=t,this.trigger("spiderfy",o,r)},u.unspiderfy=function(r){var o,i,n,s,l,p,h;if(r==e&&(r=e),this.r==e)return this;for(this.t=t,s=[],n=[],h=this.a,l=0,p=h.length;p>l;l++)i=h[l],i._omsData!=e?(i._omsData.i.setMap(e),i!==r&&i.setPosition(i._omsData.l),i.setZIndex(e),o=i._omsData.w,o!=e&&(a.removeListener(o.h),a.removeListener(o.k)),delete i._omsData,s.push(i)):n.push(i);return delete this.t,delete this.r,this.trigger("unspiderfy",s,n),this},u.f=function(t,e){var r,o;return r=t.x-e.x,o=t.y-e.y,r*r+o*o},u.C=function(t){var e,r,o,i,n;for(i=r=o=0,n=t.length;n>i;i++)e=t[i],r+=e.x,o+=e.y;return t=t.length,new s.Point(r/t,o/t)},u.c=function(t){return this.e.getProjection().fromLatLngToDivPixel(t)},u.D=function(t){return this.e.getProjection().fromDivPixelToLatLng(t)},u.B=function(t,r){var o,i,n,a,s,l;for(n=s=0,l=t.length;l>s;n=++s)a=t[n],a=r(a),("undefined"==typeof o||o===e||i>a)&&(i=a,o=n);return t.splice(o,1)[0]},u.m=function(t,r){var o,i,n,a;if(t.indexOf!=e)return t.indexOf(r);for(o=n=0,a=t.length;a>n;o=++n)if(i=t[o],i===r)return o;return-1},o.g=function(t){return this.setMap(t)},o.g.prototype=new s.OverlayView,o.g.prototype.draw=function(){},o}())}).call(this)}).call(this);